<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senternet Template Forge - Web App Collection</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Phosphor Icons (for modern icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/dist/p.min.js"></script>
    <style>
        /* Custom styles for the iframe preview container */
        .iframe-container {
            position: relative;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            overflow: hidden;
            background-color: #f7f7f7;
            border-bottom: 1px solid #e5e7eb;
        }

        .iframe-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            transform: scale(0.3); /* Smaller scale for a miniature preview */
            transform-origin: top left;
            pointer-events: none; /* Disable interaction on miniature preview */
            transition: opacity 0.3s ease;
        }
        
        /* Ensures the transform scaling is visible within the container */
        .template-card {
            /* Adjust the height based on the scaled iframe content to avoid empty space */
            height: 380px; /* Adjusting card height for aesthetic look */
        }
        
        /* Custom scrollbar for horizontal category sections */
        .horizontal-scroll {
            overflow-x: auto;
            scroll-behavior: smooth;
            padding-bottom: 1.5rem; /* Space below cards */
        }

        .horizontal-scroll::-webkit-scrollbar {
            height: 8px;
        }

        .horizontal-scroll::-webkit-scrollbar-thumb {
            background-color: #93c5fd; /* Light blue thumb */
            border-radius: 4px;
        }

        .horizontal-scroll::-webkit-scrollbar-track {
            background: #e0f2f1; /* Very light background track */
        }

        /* Responsive card width for horizontal scrolling */
        .template-list-h {
            display: flex;
            gap: 1.5rem; /* gap-6 */
        }

        .template-list-h > .template-card-wrapper {
            flex: 0 0 auto;
            width: 90%; /* Default for mobile, shows one card plus hint of next */
        }
        @media (min-width: 640px) { /* sm */
            .template-list-h > .template-card-wrapper {
                width: calc(50% - 0.75rem); /* Shows 2 cards */
            }
        }
        @media (min-width: 1024px) { /* lg */
            .template-list-h > .template-card-wrapper {
                width: calc(33.3333% - 1rem); /* Shows 3 cards */
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-slate-800 font-sans min-h-screen">

    <!-- Header & Navigation -->
    <header class="sticky top-0 bg-white/95 backdrop-blur-sm shadow-md z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col lg:flex-row justify-between items-center gap-4">
            <h1 class="text-3xl font-extrabold text-indigo-700 tracking-tight flex items-center gap-2">
                <i class="ph ph-wrench-wrench-fill text-4xl"></i> Senternet Template Forge
            </h1>
            
            <!-- Desktop Filters & Search -->
            <div class="hidden lg:flex items-center gap-4">
                <div class="relative w-72">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="search-input-desktop" oninput="filterTemplates()" placeholder="Search templates, creator..." class="w-full py-2 pl-10 pr-4 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                </div>
                <select id="category-filter-desktop" onchange="filterTemplates()" class="py-2 px-4 border border-gray-300 rounded-lg bg-white focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                    <!-- Options populated by JS -->
                </select>
                <div class="text-sm font-semibold text-gray-500">
                    Total: <span id="total-count" class="text-indigo-600 font-bold">0</span> Assets
                </div>
            </div>

            <!-- Mobile Menu Button (Hidden on Desktop) -->
            <button id="menu-icon" onclick="toggleMobileMenu()" class="lg:hidden p-2 rounded-full bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition">
                <i class="ph ph-list text-2xl"></i>
            </button>
        </div>

        <!-- Mobile Menu/Filter Panel (Initially hidden) -->
        <div id="mobile-menu" class="lg:hidden p-4 border-t border-gray-200 hidden bg-white">
            <div class="space-y-4">
                <!-- Mobile Search -->
                <div class="relative">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="search-input-mobile" oninput="filterTemplates()" placeholder="Search templates, creator..." class="w-full py-2 pl-10 pr-4 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <!-- Mobile Category Filter -->
                <select id="category-filter-mobile" onchange="filterTemplates()" class="w-full py-2 px-4 border border-gray-300 rounded-lg bg-white focus:ring-indigo-500 focus:border-indigo-500">
                    <!-- Options populated by JS -->
                </select>
                <div class="text-sm font-semibold text-center text-gray-500">
                    Total Assets: <span id="total-count-mobile" class="text-indigo-600 font-bold">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Grid -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        
        <!-- No Results Message -->
        <div id="no-results" class="hidden text-center py-20 bg-white rounded-xl shadow-inner border-4 border-dashed border-gray-200">
            <i class="ph ph-magic-wand text-6xl text-gray-400"></i>
            <h3 class="mt-4 text-2xl font-semibold text-gray-700">No Templates Found</h3>
            <p class="mt-1 text-gray-500">Try adjusting your search query or category filter.</p>
        </div>

        <!-- Template Sections Container (Dynamic Content) -->
        <div id="template-sections" class="space-y-12">
            <!-- Template groups will be rendered here -->
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-white mt-10 p-8 text-center">
        <p class="text-sm">
            Â© 2025 SENTERNET TECHNOLOGIES. <span class="font-bold">Contact: +91 81900 38085 | senternettechnologies@gmail.com.</span> Aranthangi, Pudukkottai.
        </p>
    </footer>


    <!-- Preview Modal -->
    <div id="preview-modal" class="hidden fixed inset-0 z-50 bg-black/80 transition-opacity flex items-center justify-center" onclick="if(event.target.id === 'preview-modal') closePreview()">
        <div class="bg-white rounded-xl shadow-2xl w-full h-5/6 max-w-6xl flex flex-col overflow-hidden">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-4 border-b border-gray-200">
                <h2 id="modal-title" class="text-xl font-bold text-slate-800">Template Preview</h2>
                <div class="flex items-center gap-2">
                    <button onclick="refreshIframe()" class="p-2 text-indigo-600 hover:text-indigo-800 transition">
                        <i class="ph ph-arrows-clockwise text-xl"></i>
                    </button>
                    <button onclick="closePreview()" class="p-2 text-red-500 hover:text-red-700 transition">
                        <i class="ph ph-x text-xl"></i>
                    </button>
                </div>
            </div>
            <!-- Modal Body (Iframe) -->
            <div class="flex-grow relative">
                <!-- Loader -->
                <div id="loader" class="absolute inset-0 bg-white flex items-center justify-center z-10">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
                </div>
                <!-- Iframe -->
                <iframe id="preview-frame" src="about:blank" class="w-full h-full border-0"></iframe>
            </div>
        </div>
    </div>


    <script>
        // --- IMPORTANT CONFIGURATION ---
        const WHATSAPP_NUMBER = '918190038085'; // Senthilkumar's WhatsApp number
        // NOTE: Please replace this placeholder with the actual UPI ID for transactions.
        const UPI_PAYEE_ADDRESS = 'senthilkumar@oksbi'; // Placeholder UPI ID
        const UPI_PAYEE_NAME = 'SENTERNET TECHNOLOGIES';

        // --- DATA ---
        const templates = [
            // Using bright theme colors for template categories
            // Business Tools
            { id: 'invoice Generator and Tracker web application called InvoiceFlow', title: 'Invoice Flow Generator', url: 'invoice1.html', desc: 'A webapp of invoice generator, here can generate and calculate taxes from entries.', category: 'Business Tools', color: 'text-fuchsia-600', creator: 'Senthil', price_in_inr: 1299 },
            { id: 'Contactssender', title: 'Contacts Sender Tool', url: 'contacts.html', desc: 'A bulk message sender tool for direct, spam-free communication.', category: 'Business Tools', color: 'text-green-600', creator: 'Haritha (Digital Mkt.)', price_in_inr: 999 },
            { id: '1 Contactssender', title: 'SMS / WhatsApp Sender Tool', url: 'sms.html', desc: 'A bulk message sender tool for direct WhatsApp / SMS, spam-free communication for Normal SMS & WhatsApp.', category: 'Business Tools', color: 'text-green-600', creator: 'Senthil (CEO)', price_in_inr: 999 },
            { id: 'home', title: 'Senternet Home Landing', url: 'home.html', desc: 'The official company landing page template with a service overview structure.', category: 'Business Tools', color: 'text-indigo-600', creator: 'Senthil (CEO)', price_in_inr: 299 },
            // E-commerce
            { id: 'honeyselling', title: 'Honey Selling Website', url: 'honey.html', desc: 'Simple, conversion-focused landing page for premium honey products.', category: 'E-commerce', color: 'text-amber-600', creator: 'Kumar (Web Designer)', price_in_inr: 199 },
            { id: 'roller', title: 'Roller Menu Boutique', url: 'rollermenu.html', desc: 'An interactive scrolling menu concept for high-end fashion boutiques or restaurants.', category: 'E-commerce', color: 'text-amber-600', creator: 'Anitha (Backend Worker)', price_in_inr: 399 },
            // Products Showcase
            { id: 'paint', title: 'Lumina Paints Webapp', url: 'lumina.html', desc: 'Allows customers to check color mixing, visualize paints on walls, and place orders.', category: 'Product Showcase', color: 'text-pink-600', creator: 'Santhosh (Web Dev)', price_in_inr: 599 },
            // AI Tools
            { id: 'senai', title: 'Sen AI - Post Generator', url: 'senai.html', desc: 'AI tool for generating creative social media posts (text, image, description).', category: 'AI Tools', color: 'text-rose-600', creator: 'Swetha (Digital Mkt.)', price_in_inr: 799 },
            // Portfolio
            { id: 'riya', title: 'Riya Mehandi Portfolio', url: 'riya.html', desc: 'Artistic case study and portfolio showcase for Mehandi designs.', category: 'Portfolio', color: 'text-purple-600', creator: 'Sathish (Graphic Designer)', price_in_inr: 149 },
            { id: 'portfolio', title: 'Developer Portfolio', url: 'portfolio1.html', desc: 'A professional personal branding site template for modern developers.', category: 'Portfolio', color: 'text-purple-600', creator: 'Santhosh (Web Dev)', price_in_inr: 149 },
            // Experimental
            { id: 'os', title: 'Sen Windows OS Clone', url: 'sen-os.html', desc: 'An experimental web-based operating system simulation concept UI.', category: 'Experimental/UI', color: 'text-sky-600', creator: 'Surya (Backend/Web)', price_in_inr: 999 },
            { id: 'camera', title: 'Sen camera basic template', url: 'camera.html', desc: 'An experimental web-based camera simulation concept UI.', category: 'Experimental/UI', color: 'text-sky-600', creator: 'Surya (Backend/Web)', price_in_inr: 99 },
            { id: 'to do list', title: 'To Do List App', url: 'todo.html', desc: 'A modern, simple to-do list web app concept UI.', category: 'Experimental/UI', color: 'text-sky-600', creator: 'Surya (Backend/Web)', price_in_inr: 12 },
            { id: 'vortex experimental' , title: 'vortex', url: 'vortex.html', desc: 'virtex experimental project, wave lines.', category: 'Experimental/UI', color: 'text-sky-600', creator: 'Surya (Backend/Web)', price_in_inr: 645 },
            { id: 'water ripple wave simulation ', title: 'Water ripple digital 2d wave', url: 'ripple.html', desc: '2d water ripples, interactive.', category: 'Experimental', color: 'text-sky-600', creator: 'Senthil(Backend/Web)', price_in_inr: 645 },
            // Media
            { id: 'jio stream', title: 'Jio stream basic template', url: 'jiostream.html', desc: 'Template for Jio Stream app - modern media UI replication.', category: 'Media/UI', color: 'text-red-600', creator: 'Saran (SMM)', price_in_inr: 99 },
            { id: 'youtube', title: 'YouTube Clone UI', url: 'youtube.html', desc: 'Video streaming platform UI template with a fully responsive grid layout.', category: 'Media/UI', color: 'text-red-600', creator: 'Shanthi (Digital Mkt.)', price_in_inr: 249 },
            { id: 'connect feed templte social app', title: 'Connect feed', url: 'connectfeed.html', desc: 'template static webapp, contact admin for make dynamic and free bckend.', category: 'Media/UI', color: 'text-sky-600', creator: 'Senthil (Backend/Web)', price_in_inr: 645 },
            { id: 'sentagram social app', title: 'sentagram social app template', url: 'sentagram.html', desc: 'template static webapp, contact admin for make dynamic and free bckend.', category: 'Media/UI', color: 'text-sky-600', creator: 'Senthil (Backend/Web)', price_in_inr: 2350 },
            { id: 'chatsphere', title: 'Chatsphere', url: 'chatsphere.html', desc: 'chatting template webapp, contct admin for bckend.', category: 'Media/UI', color: 'text-sky-600', creator: 'Surya (Backend/Web)', price_in_inr: 645 },
            // Finance
            { id: 'gpay', title: 'G-Pay Clone UI', url: 'gpay.html', desc: 'A sleek UI replication of the Google Pay payment interface for fintech concepts.', category: 'Finance', color: 'text-emerald-600', creator: 'Kumar (Web Designer)', price_in_inr: 199 },
            // Travel
            { id: 'FlightBooking', title: 'Flight Booking App', url: 'FlightBookingApp.html', desc: 'A basic-level flight ticket booking template for travel agencies.', category: 'Travel', color: 'text-yellow-600', creator: 'Arun (Design)', price_in_inr: 349 },
            // Gallery
            { id: 'articans', title: 'Articans Gallery', url: 'articans.html', desc: 'A creative arts and craft gallery showcase template.', category: 'Gallery', color: 'text-orange-600', creator: 'Saran (SMM)', price_in_inr: 199 },
            // Riddle
            { id: 'maths', title: 'Horse allocation riddleðŸŽ', url: 'horse.html', desc: 'Simple riddle calculation of allocating horse.', category: 'Riddle', color: 'text-orange-600', creator: 'Senthil (CEO)', price_in_inr: 59 },
            // Job
            { id: 'earn money online data entry', title: 'earn money Data entry work', url: 'earn1.html', desc: 'here you can just make data entry for given datas, also here you can check and validate datas of workers.', category: 'job', color: 'text-orange-600', creator: 'Senthil (CEO)', price_in_inr: 50 },
            // Games
            { id: 'Chess Offline game', title: 'Chess Offline - Game', url: 'chess.html', desc: 'A simple "chess" basic game template for interactive content.', category: 'Games', color: 'text-fuchsia-600', creator: 'Siva (Product Mkt.)', price_in_inr: 39 },
            { id: 'Flavour fusion game', title: 'Flavour Fusion - Game', url: 'flavourfusion.html', desc: 'A simple "cook and serve" basic game template for interactive content.', category: 'Games', color: 'text-fuchsia-600', creator: 'Siva (Product Mkt.)', price_in_inr: 299 },
            { id: 'snake game 2d', title: 'snake clssic 2d', url: 'snake1.html', desc: '2d classic snake game.', category: 'Games', color: 'text-sky-600', creator: 'Senthil(Backend/Web)', price_in_inr: 645 },
        ];

        // --- DOM ELEMENTS ---
        const sectionsContainer = document.getElementById('template-sections');
        const modal = document.getElementById('preview-modal');
        const iframe = document.getElementById('preview-frame');
        const modalTitle = document.getElementById('modal-title');
        const loader = document.getElementById('loader');
        const noResultsDiv = document.getElementById('no-results');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');

        const searchInputDesktop = document.getElementById('search-input-desktop');
        const categoryFilterDesktop = document.getElementById('category-filter-desktop');
        const searchInputMobile = document.getElementById('search-input-mobile');
        const categoryFilterMobile = document.getElementById('category-filter-mobile');
        const totalCountDisplay = document.getElementById('total-count');
        const totalCountDisplayMobile = document.getElementById('total-count-mobile');

        // --- UPI LINK GENERATION ---
        function generateUpiLink(item) {
            // Encode the transaction note
            const transactionNote = encodeURIComponent(`SENTERNET Template: ${item.title} (ID: ${item.id.substring(0, 10)})`);
            
            // Format amount to two decimal places, e.g., 1299.00
            const amountFormatted = item.price_in_inr.toFixed(2);
            
            // Construct the UPI URI
            const upiLink = `upi://pay?pa=${UPI_PAYEE_ADDRESS}&pn=${encodeURIComponent(UPI_PAYEE_NAME)}&mc=0000&cu=INR&tn=${transactionNote}&am=${amountFormatted}`;
            
            return upiLink;
        }

        // --- EVENT HANDLERS ---

        window.openUpiPay = function(itemTitle, itemId, itemPrice) {
            const item = templates.find(t => t.id === itemId);
            if (!item) return console.error('Template not found for UPI payment.');
            
            const upiLink = generateUpiLink(item);
            
            // Redirect to the UPI application
            window.location.href = upiLink;

            console.log(`Attempting UPI payment for: ${itemTitle} at INR ${itemPrice}`);
            console.log(`Generated UPI Link: ${upiLink}`);
        }
        
        window.openWhatsappChat = function(title, id, price) {
            const priceFormatted = new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0,
            }).format(price);
            
            const message = `*Template Customization Inquiry* (From Template Forge):%0A%0AHello Senternet Team! I am interested in *customizing* the following asset:%0A- *Title*: ${title}%0A- *ID*: ${id}%0A- *Price*: ${priceFormatted}%0A%0APlease discuss customization options and next steps.`;
            
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${message}`;
            
            window.open(whatsappUrl, '_blank');
        };

        // --- UTILITY FUNCTIONS ---
        function groupTemplatesByCategory(filteredTemplates) {
            return filteredTemplates.reduce((groups, item) => {
                const category = item.category || 'Uncategorized';
                if (!groups[category]) { groups[category] = []; }
                groups[category].push(item);
                return groups;
            }, {});
        }

        // Generate template card HTML (Updated for light theme styling and two buttons)
        function generateCardHTML(item) {
            let iconClass = 'ph-browsers';
            if (item.category.includes('Games')) iconClass = 'ph-game-controller';
            else if (item.category.includes('AI Tools')) iconClass = 'ph-brain';
            else if (item.category.includes('E-commerce')) iconClass = 'ph-storefront';
            else if (item.category.includes('Finance')) iconClass = 'ph-currency-circle-dollar';
            else if (item.category.includes('Portfolio')) iconClass = 'ph-user-list';
            else if (item.category.includes('Experimental')) iconClass = 'ph-flask-gear';

            const priceFormatted = new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0,
            }).format(item.price_in_inr);
            
            // Use item.id to reliably find the template for UPI function
            const itemId = item.id.replace(/'/g, "\\'"); // Sanitize for JS string

            return `
                <div class="template-card-wrapper">
                    <div class="template-card bg-white rounded-xl shadow-xl hover:shadow-2xl transition duration-300 border border-indigo-100 flex flex-col h-full overflow-hidden">
                        
                        <!-- Iframe Preview Area -->
                        <div class="iframe-container cursor-pointer" onclick="openPreview('${item.url}', '${item.title}')">
                            <iframe src="${item.url}" 
                                class="iframe-preview" 
                                scrolling="no" loading="lazy" tabindex="-1">
                            </iframe>
                            <div class="absolute inset-0 bg-black/10 flex items-center justify-center opacity-0 hover:opacity-100 transition duration-300 z-10">
                                <span class="text-sm font-bold text-white p-3 rounded-full bg-indigo-600/90 shadow-2xl flex items-center gap-2">
                                    <i class="ph ph-eye text-lg"></i> LIVE PREVIEW
                                </span>
                            </div>
                        </div>

                        <!-- Card Body -->
                        <div class="p-5 flex-grow flex flex-col relative z-20 bg-white">
                            <span class="text-xs font-bold uppercase tracking-wider ${item.color} bg-indigo-50 px-3 py-1 rounded-full self-start flex items-center gap-1">
                                <i class="ph ${iconClass} text-base"></i> ${item.category.split('/')[0]}
                            </span>
                            
                            <h3 class="text-xl font-bold text-slate-900 mt-3 mb-1 line-clamp-1">${item.title}</h3>
                            <p class="text-gray-500 text-sm line-clamp-2 mb-4">${item.desc}</p>
                            
                            <!-- Price and Creator -->
                            <div class="flex justify-between items-center text-sm font-semibold mb-4 border-t border-gray-100 pt-3 mt-auto">
                                <p class="flex flex-col text-slate-700">
                                    <span class="text-xs font-medium text-gray-400">Crafted by:</span>
                                    <span class="text-slate-800 font-medium">${item.creator}</span>
                                </p>
                                <p class="flex items-center gap-1 text-green-600 text-2xl font-black">
                                    ${priceFormatted}
                                </p>
                            </div>
                            
                            <!-- Actions (Split into UPI Pay and WhatsApp Chat) -->
                            <div class="flex gap-2">
                                <button onclick="openUpiPay('${item.title}', '${itemId}', ${item.price_in_inr})"
                                    class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-3 rounded-xl text-sm transition-colors shadow-lg shadow-indigo-300/50 flex justify-center items-center gap-2">
                                    <i class="ph ph-wallet text-lg"></i> Buy Now (UPI)
                                </button>
                                <button onclick="openWhatsappChat('${item.title}', '${itemId}', ${item.price_in_inr})"
                                    class="w-1/4 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-3 rounded-xl text-sm transition-colors shadow-lg shadow-green-300/50 flex justify-center items-center">
                                    <i class="ph ph-whatsapp-logo text-lg"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render templates - logic updated for horizontal scrolling groups
        function renderTemplates(filteredTemplates) {
            sectionsContainer.innerHTML = '';
            totalCountDisplay.innerText = filteredTemplates.length;
            totalCountDisplayMobile.innerText = filteredTemplates.length;

            if (filteredTemplates.length === 0) {
                noResultsDiv.classList.remove('hidden');
                return;
            } else {
                noResultsDiv.classList.add('hidden');
            }

            const groupedTemplates = groupTemplatesByCategory(filteredTemplates);
            const categories = Object.keys(groupedTemplates).sort();

            categories.forEach(category => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'category-section mb-10';

                const categoryTitleHtml = `
                    <div class="flex items-center justify-between mb-6 border-b-4 border-indigo-200 pb-3">
                        <h4 class="text-3xl font-extrabold text-slate-800 flex items-center gap-3">
                            <i class="ph ph-squares-four text-indigo-500"></i> ${category} 
                        </h4>
                        <span class="text-sm font-medium text-indigo-600 bg-indigo-100 px-3 py-1 rounded-full">${groupedTemplates[category].length} Templates</span>
                    </div>
                `;

                const cardsHtml = groupedTemplates[category].map(item => `
                    <div class="template-card-wrapper">
                        ${generateCardHTML(item)}
                    </div>
                `).join('');

                sectionDiv.innerHTML = `
                    ${categoryTitleHtml}
                    <div class="horizontal-scroll">
                        <div class="template-list-h">
                            ${cardsHtml}
                        </div>
                    </div>
                `;
                sectionsContainer.appendChild(sectionDiv);
            });
        }

        // Populate category filter dropdowns (Same logic)
        function populateCategoryFilters() {
            const categories = [...new Set(templates.map(t => t.category))].sort();
            
            const optionsHtml = categories.map(category => 
                `<option value="${category}">${category.split('/')[0]} (${templates.filter(t => t.category === category).length})</option>`
            ).join('');
            
            const allOption = '<option value="">All Categories</option>';
            
            categoryFilterDesktop.innerHTML = allOption + optionsHtml;
            categoryFilterMobile.innerHTML = allOption + optionsHtml;
        }

        // Filter logic (Merged logic for desktop/mobile)
        window.filterTemplates = function() {
            const isDesktop = window.innerWidth >= 1024;
            const searchInput = isDesktop ? searchInputDesktop : searchInputMobile;
            const categoryFilter = isDesktop ? categoryFilterDesktop : categoryFilterMobile;

            const searchTerm = (searchInput?.value || '').toLowerCase().trim();
            const selectedCategory = categoryFilter?.value || '';

            // Sync state between desktop and mobile inputs
            if (isDesktop) {
                searchInputMobile.value = searchTerm;
                categoryFilterMobile.value = selectedCategory;
            } else {
                searchInputDesktop.value = searchTerm;
                categoryFilterDesktop.value = selectedCategory;
            }

            const filtered = templates.filter(item => {
                const searchFields = [
                    item.title, item.desc, item.creator, item.id, item.category
                ].map(s => String(s).toLowerCase());
                
                const matchesSearch = !searchTerm || searchFields.some(field => field.includes(searchTerm));
                
                const matchesCategory = !selectedCategory || item.category === selectedCategory;

                return matchesSearch && matchesCategory;
            });

            renderTemplates(filtered);
        };

        // --- MOBILE UI FUNCTIONS ---
        window.toggleMobileMenu = function() {
            mobileMenu.classList.toggle('hidden');
            if (mobileMenu.classList.contains('hidden')) {
                menuIcon.innerHTML = '<i class="ph ph-list text-2xl"></i>';
            } else {
                menuIcon.innerHTML = '<i class="ph ph-x text-2xl"></i>';
            }
        };


        // --- MODAL FUNCTIONS ---

        window.openPreview = function(url, title) {
            modalTitle.innerText = title;
            modal.classList.remove('hidden');
            loader.classList.remove('hidden');
            iframe.src = url;
            iframe.onload = function() {
                // Adjust scale of iframe content after load for better look
                if (iframe.contentWindow) {
                    // Try to adjust the scale to 1.0 (full size) if possible
                    iframe.contentWindow.document.body.style.transform = 'scale(1)';
                    iframe.contentWindow.document.body.style.transformOrigin = 'top left';
                    iframe.contentWindow.document.body.style.pointerEvents = 'auto';
                }
                loader.classList.add('hidden');
            };
            document.body.style.overflow = 'hidden';
        };

        window.closePreview = function() {
            modal.classList.add('hidden');
            iframe.src = 'about:blank';
            document.body.style.overflow = 'auto';
        };

        window.refreshIframe = function() {
            if(iframe.src && iframe.src !== 'about:blank') {
                loader.classList.remove('hidden');
                const currentUrl = iframe.src;
                iframe.src = 'about:blank'; 
                setTimeout(() => {
                    iframe.src = currentUrl; 
                }, 50);
            }
        };

        // --- INITIALIZATION ---
        window.onload = function() {
            populateCategoryFilters();
            renderTemplates(templates);
        };
        
        window.onresize = filterTemplates;

    </script>
</body>
</html>
